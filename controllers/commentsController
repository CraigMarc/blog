const Comments = require("../models/comments");
const asyncHandler = require("express-async-handler");
const { body, validationResult } = require("express-validator");
/*
Book.find({ author: req.params.id }, "title summary").exec(),
*/

// get all comments

exports.all_comments_get = asyncHandler(async (req, res, next) => {

  //let allComments = await Comments.find().exec()

  //return res.json(allComments)
  try {
    let allComments = await Comments.find().exec()
    res.status(200).json(allComments)
  } catch (error) {
    res.status(500).json({ message: error });
  }
  
});


//create new comment
exports.comments_create = asyncHandler(async (req, res, next) => {


  const comment = new Comments({
    text: req.body.text,
    posts_id: req.body.posts_id

  });

  //await comment.save();
  //return res.send(comment);
  try {
    await comment.save()
    res.status(200).json(comment)
  } catch (error) {
    res.status(500).json({ message: error });
  }

});



//delete comment

exports.comments_delete = asyncHandler(async (req, res, next) => {
  
  //await Comments.findByIdAndDelete(req.params.commentId);
  //return res.send('deleted')
  try {
    await Comments.findByIdAndDelete(req.params.commentId);
    res.status(200).json({deleted: req.params.commentId})
  } catch (error) {
    res.status(500).json({ message: error });
  }

});

